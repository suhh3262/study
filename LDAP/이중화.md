# ì´ì¤‘í™” êµ¬ì„± í…ŒìŠ¤íŠ¸
<br>

### í…ŒìŠ¤íŠ¸ í™˜ê²½
`docker` : Slave
`docker2` : Master

|Hostname|IP|Role|
|-----|------|------|
|docker1|192.168.56.11|Master (Provider)|
|docker2|192.168.56.12|Slave (Consumer)|

![Image](https://github.com/user-attachments/assets/b348ed22-f2ad-4693-bd95-b732a131dfeb)

<br>

---

### 1. Master, Slave ê³µí†µ í™˜ê²½ ìƒì„±
- ë‘ ëŒ€ì˜ LDAP ì„œë²„ë¥¼ Master-Slave êµ¬ì¡°ë¡œ ë§Œë“¤ê¸° ì „, ldap ì„œë¹„ìŠ¤ ì„¤ì¹˜
- ì•„ë˜ ì„¤ì •ì€ ë‘ ëŒ€ì— ëª¨ë‘ ë™ì¼í•˜ê²Œ ì ìš©

<br>

1. í•„ìš” íŒ¨í‚¤ì§€ ì„¤ì¹˜
   ```
   yum -y install openldap compat-openldap openldap-clients openldap-servers openldap-servers-sql openldap-devel
   ```

2. slapd ë°ëª¬ ìë™ì‹œì‘ ì„¤ì • ë° êµ¬ë™
   ```
   # systemctl start slapd
   # systemctl enable slapd
   ```

3. 389 portê°€ ì •ìƒì ìœ¼ë¡œ listen ì¤‘ì¸ì§€ í™•ì¸ í›„, ë°©í™”ë²½ì— í•´ë‹¹ í¬íŠ¸ í—ˆìš© ì¶”ê°€
   ```
   # netstat-tupln | grep 389
   # firewalld-cmd --permanent --zone=public --add-port=389/tcp
   # firewalld-cmd --zone=public -add-port=389/tcp
   // ë‚œ ê·¸ëƒ¥ ë°©í™”ë²½ ë„ê³  ì§„í–‰í•˜ë®¤
   ```

4. LDAP ê´€ë ¨ ë¡œê·¸ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ rsyslog ì„¤ì • ë³€ê²½
   ```
   # vi /etc/rsyslog.conf
   ```
   ![Image](https://github.com/user-attachments/assets/0ffef99d-32bc-4789-a2c7-527386d3f590)
   ```
   # systemctl restart rsyslog
   ```

5. /etc/hostsì— ê° ì„œë²„ì˜ ì •ë³´ ë„£ê¸°
   ```
   # vi /etc/hosts
   ```
   ![Image](https://github.com/user-attachments/assets/af7f62f7-b24c-4d29-8be1-6d8a13462288)

6. LDAP Admin Password ì„¸íŒ…
   ```
   # slappasswd

   New password:
   Re-enter new password:
   {SSHA}JCTZ/3YY6qxVBQ49pX9sij1ghSt1Su2n
   ```

7. LDAP ì„œë²„ ì„¤ì •
   - ì„¤ì •íŒŒì¼ì„ ì§ì ‘ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìƒˆë¡œìš´ íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ì ìš©ì‹œí‚¬ ê²ƒì„
   - ìˆ˜ì •í•  ë‚´ìš©
      - `olcSuffix` : Database Suffixë¡œ, LDAP ì„œë²„ê°€ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ë„ë©”ì¸ ì´ë¦„. ì—¬ê¸°ì„œëŠ” test.localì— í•´ë‹¹
      - `olcRootDN` : root ìœ ì €ì²˜ëŸ¼ LDAPì— ìˆì–´ ëª¨ë“  ê´€ë¦¬ì ê¶Œí•œì„ ìˆ˜í–‰í•˜ëŠ” ìœ ì €ë¥¼ ìœ„í•œ RDN (Root Distinguished Name) Entry
      - `olcRootPW` : ìœ„ RootDNì„ ìœ„í•œ Root PW

    #### 7.1 íŒŒì¼ ì„¤ì •
    ```
    # vi db.ldif
    
    dn: olcDatabase={2}hdb,cn=config
    changetype: modify
    replace: olcSuffix
    olcSuffix: dc=test,dc=local
    
    dn: olcDatabase={2}hdb,cn=config
    changetype: modify
    replace: olcRootDN
    olcRootDN: cn=ldapadm,dc=test,dc=local
    
    dn: olcDatabase={2}hdb,cn=config
    changetype: modify
    replace: olcRootPW
    olcRootPW: {SSHA}JCTZ/3YY6qxVBQ49pX9sij1ghSt1Su2n
    ```
    
    #### 7.2 íŒŒì¼ ì ìš©
    ```
    # ldapmodify -Y EXTERNAL -H ldapi:/// -f db.ldif
    
    SASL/EXTERNAL authentication started
    SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
    SASL SSF: 0
    modifying entry "olcDatabase={2}hdb,cn=config"
    modifying entry "olcDatabase={2}hdb,cn=config"
    modifying entry "olcDatabase={2}hdb,cn=config"
    ```
    
    #### 7.3 monitor.ldif ìƒì„± (root ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡)
    ```
    # vi monitor.ldif
    ```
    ```
    [root@docker2 ~]# ldapmodify -Y EXTERNAL -H ldapi:/// -f monitor.ldif
    SASL/EXTERNAL authentication started
    SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth
    SASL SSF: 0
    modifying entry "olcDatabase={1}monitor,cn=config"
    ```

  8. LDAP DB ì„¤ì •
     - DB ìƒ˜í”Œ íŒŒì¼ì„ cpí•œ í›„, ê¶Œí•œ ìˆ˜ì •
       ```
       [root@docker2 ~]# cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG
       [root@docker2 ~]# chown ldap:ldap /var/lib/ldap/*
       ```

     - LDAP DBì— consineê³¼ nis ìŠ¤í‚¤ë§ˆ ì¶”ê°€
       ```
       # ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/cosine.ldif
       # ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/nis.ldif 
       # ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/schema/inetorgperson.ldif
       ```

     - ë„ë©”ì¸ êµ¬ì¡° ìƒì„±ì„ ìœ„í•œ base file ì¶”ê°€ë¡œ ìƒì„±
       ```
       # vi base.ldif

       dn: dc=test,dc=local
       dc: test
       objectClass: top
       objectClass: domain
       
       
       dn: cn=ldapadm, dc=test,dc=local
       objectClass: organizationalRole
       cn: ldapadm
       description: LDAP Manager
       
       dn: ou=People, dc=test,dc=local
       objectClass: organizationalUnit
       ou: People
       
       dn: ou=Group, dc=test,dc=local
       objectClass: organizationalUnit
       ou: Group
       ```
       ```
       # ldapadd -x -W -D "cn=ldapadm,dc=test,dc=local" -f base.ldif
       ```
<br>

ğŸŒŸì—¬ê¸°ê¹Œì§€ê°€ Masterì™€ Slave ì„œë²„ì˜ ê¸°ë³¸ ì„¸íŒ…. ì•„ë˜ë¶€í„°ëŠ” Master/Slave êµ¬ë¶„í•˜ì—¬ ì§„í–‰!!!ğŸŒŸ

---

### 2. Master Server ì„¸íŒ…
